# コーディングルール

## 目的

この文書は、プロジェクト内のコードに対して「簡潔さ」と「分割（分離）」を徹底するための最低限のルールを示します。読みやすさ・保守性を高め、重複や肥大化を防ぎます。

## 共通原則

- 簡潔さを最優先する: 不要な処理や冗長な実装を避ける。1つの関数は1つの責務に絞る。
- 分割（分離）: 機能は小さく明確な単位に分け、責務が混ざらないようにする。再利用可能でテストしやすい設計を目指す。
- 明確な境界: 詳細実装は内部に隠し、公開インターフェースは簡潔で理解しやすくする。

## コーディングのルール

- 単一責任: 関数・モジュールは単一の役割に限定する（長さより責務で判断）。
- 小さな関数を好む: 複雑な処理は小さな補助関数に分割し、上位関数は高レベルの流れだけを記述する。
- 明確なモジュール境界: 公開APIと内部実装を分離し、モジュール間の依存を最小化する。
- ドキュメントコメント: 重要な公開関数には短い説明（1–2行）を付け、詳細は別ドキュメントへ誘導する。
- テストで仕様を補完: 振る舞いの詳細はテストに書き、コードは簡潔に保つ。

## アップデートの実装ルール

- 段階的開発: 大きな機能追加は小さな単位に分割し、各段階で動作確認を行う。
- 動作テスト必須: 各実装段階で `cargo run` による動作確認、既存機能の回帰テストを実行する。
- コミット単位の管理: 機能単位でgitコミットを作成し、問題発生時のロールバックを容易にする。
- 統合前の安定化: 個別機能が完全に安定してから統合し、全体動作を最終確認する。

## 実践ガイド（短いチェックリスト）

- この関数の責務を1行で書けるか？ 書けなければ分割する。
- 同じ処理が別の箇所にないか確認する。あれば共通化する。
- 関数が100行を超える場合は分割候補とする（目安）。
- モジュールは外部に公開するAPIを明確にし、内部実装は隠す。

## 参考と例

- コードは『public: 高レベルの意図』→『private: 実装詳細』の順で置く。
- 複雑なロジックは小さな関数に分割し、メイン関数は流れの記述に集中する。

## 依存関係管理

### ライブラリ追加

- 新しいcrateの追加は `cargo add` コマンドを使用する
- 手動でのCargo.toml編集は避け、コマンドベースでの管理を徹底する
- 追加理由と用途を短くコメントまたはドキュメントに記録する

### 例

```bash
cargo add clap          # CLI引数処理用
cargo add serde --features derive  # シリアライゼーション用
```

## 運用

- プルリクで「簡潔化」「分割」の観点をコードレビューチェックリストに入れる。
- 大幅なリファクタリングや分割はCHANGELOGに短く理由を記述する。

---
追記: 本ファイルは短く保ち、詳細なコーディングスタイルや具体例は必要に応じて別ファイルに切り出してください。
